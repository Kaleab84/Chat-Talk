import{j as e,r as l,g as N,c as D,R as $}from"./styles-BHOL1DZm.js";function B({attachments:t=[],onImageClick:i}){return t.length?e.jsx("div",{className:"img-grid",children:t.map(n=>e.jsx("button",{type:"button",className:"img-grid-btn",onClick:()=>i==null?void 0:i(n),children:e.jsx("img",{src:n.previewUrl,alt:n.name||"attachment"})},n.id))}):null}function O({message:t,onImageClick:i}){const n=t.role==="user"?"user":"bot",c=["msg",n];t.isTyping&&c.push("typing"),t.isError&&c.push("err");const u=t.isTyping?e.jsxs("span",{className:"typing-text",children:["Assistant is thinking",e.jsx("span",{className:"dots",children:"…"})]}):t.text;return e.jsxs("div",{className:c.join(" "),children:[e.jsx("p",{className:"msg-text",children:u}),n==="user"&&Array.isArray(t.attachments)&&t.attachments.length?e.jsx(B,{attachments:t.attachments,onImageClick:i}):null,t.timestamp?e.jsx("div",{className:"meta",children:t.timestamp}):null]})}function P({messages:t=[],onImageClick:i}){const n=l.useRef(null);return l.useEffect(()=>{const c=n.current;c&&(c.scrollTop=c.scrollHeight)},[t]),e.jsx("div",{className:"thread",ref:n,"aria-live":"polite","aria-relevant":"additions",children:t.map(c=>e.jsx(O,{message:c,onImageClick:i},c.id))})}function q({attachments:t=[],onRemove:i}){return t.length?e.jsx("div",{className:"attachment-strip",children:t.map(n=>e.jsxs("div",{className:"attachment-chip",children:[e.jsx("img",{src:n.previewUrl,alt:n.name||"attachment"}),e.jsxs("div",{className:"attachment-meta",children:[e.jsx("div",{className:"attachment-name",children:n.name||"Attachment"}),e.jsx("button",{type:"button",onClick:()=>i==null?void 0:i(n.id),"aria-label":`Remove ${n.name||"attachment"}`,children:"×"})]})]},n.id))}):null}function C({image:t,onClose:i}){return l.useEffect(()=>{if(!t)return;const n=c=>{c.key==="Escape"&&(i==null||i())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[t,i]),e.jsx("div",{className:`img-modal ${t?"active":""}`,onClick:()=>i==null?void 0:i(),role:"dialog","aria-label":"Image preview","aria-modal":"true",children:t?e.jsx("img",{src:t.previewUrl,alt:t.name||"attachment preview",onClick:n=>n.stopPropagation()}):null})}const v=()=>{const t=typeof globalThis<"u"?globalThis.crypto:null;return t!=null&&t.randomUUID?t.randomUUID():`msg-${Date.now()}-${Math.random().toString(16).slice(2)}`},b=()=>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});function F(){const[t,i]=l.useState(()=>N()),[n,c]=l.useState(""),[u,p]=l.useState([]),[d,g]=l.useState([]),[f,y]=l.useState(!1),[k,w]=l.useState(null),m=l.useRef(null);l.useEffect(()=>{i(N())},[]);const S=l.useCallback(a=>{if(!(a!=null&&a.length))return;const h=a.map(r=>({id:v(),name:r.name||"attachment",previewUrl:URL.createObjectURL(r),file:r}));g(r=>[...r,...h])},[]),A=a=>{const h=Array.from(a.target.files||[]);S(h),a.target.value=""},L=a=>{g(h=>{const r=h.find(s=>s.id===a);if(r!=null&&r.previewUrl)try{URL.revokeObjectURL(r.previewUrl)}catch{}return h.filter(s=>s.id!==a)})},U=()=>{g([])},T=async()=>{const a=n.trim();if(!a&&!d.length)return;const h={id:v(),role:"user",text:a,attachments:d.map(s=>({id:s.id,name:s.name,previewUrl:s.previewUrl})),timestamp:b()},r=v();p(s=>[...s,h,{id:r,role:"assistant",text:"Assistant is thinking…",isTyping:!0}]),c(""),y(!0);try{let s;if(d.length){const o=new FormData;o.append("question",a),o.append("top_k","4"),d.forEach(R=>o.append("images",R.file)),s=await(await fetch("/ask-with-media",{method:"POST",body:o})).json()}else s=await(await fetch("/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:a,top_k:4})})).json();const x=s!=null&&s.success?s.answer||"No answer provided yet.":(s==null?void 0:s.detail)||"Request failed.";p(o=>o.map(j=>j.id===r?{id:r,role:"assistant",text:x,isTyping:!1,isError:!(s!=null&&s.success),timestamp:b()}:j))}catch(s){p(x=>x.map(o=>o.id===r?{id:r,role:"assistant",text:String(s),isTyping:!1,isError:!0,timestamp:b()}:o))}finally{y(!1),U(),m.current&&(m.current.value="")}},E=a=>{a.preventDefault(),T()},I=a=>w(a),M=()=>w(null);return e.jsxs("div",{className:"react-app",children:[e.jsxs("header",{className:"container header react-header",children:[e.jsx("div",{className:"brand",children:"CFC Technologies"}),e.jsx("div",{className:"greet",children:t?`Hi, ${t}!`:"Welcome back"})]}),e.jsx("main",{className:"container chat-container",children:e.jsx("section",{className:"panel active chat-panel",children:e.jsxs("div",{className:"panel-body chat-panel-body",children:[e.jsx("h2",{children:"AI Support Assistant"}),e.jsx(P,{messages:u,onImageClick:I}),e.jsx(q,{attachments:d,onRemove:L}),e.jsxs("form",{className:"chat-input react-chat-input",onSubmit:E,children:[e.jsx("input",{type:"text",placeholder:"Ask anything about CFC software…",value:n,onChange:a=>c(a.target.value),disabled:f}),e.jsx("input",{ref:m,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:A}),e.jsx("button",{type:"button",className:"btn icon",onClick:()=>{var a;return(a=m.current)==null?void 0:a.click()},"aria-label":"Attach images",disabled:f,children:e.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M21 8.5l-9.19 9.19a5 5 0 01-7.07 0h0a5 5 0 010-7.07L13.5 1.75a3.5 3.5 0 114.95 4.95L8.3 16.86a2 2 0 01-2.83 0h0a2 2 0 010-2.83L15.2 4.31",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"btn icon",type:"submit",disabled:f,"aria-label":"Send message",children:e.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M3 11.5l18-8-8 18-2.5-6.5L3 11.5z",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{className:"meta",children:d.length?`${d.length} image${d.length>1?"s":""} ready to send`:"Images are optional. Upload screenshots for richer answers."})]})})}),e.jsx("footer",{className:"container footer",children:e.jsx("a",{className:"btn",href:"/ui/login.html","aria-label":"Back to Login",children:"Back to Login"})}),e.jsx(C,{image:k,onClose:M})]})}D.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(F,{})}));
