import{r as i,j as e,g as k,c as S,R as D}from"./styles-BHOL1DZm.js";const E=String.fromCodePoint(128228);function w({onFileSelected:s}){const r=i.useRef(null),[t,l]=i.useState(!1),n=a=>{a!=null&&a.length&&(s==null||s(a[0]),r.current&&(r.current.value=""))};return e.jsxs("div",{className:`dropzone ${t?"dragover":""}`,role:"button",tabIndex:0,onClick:()=>{var a;return(a=r.current)==null?void 0:a.click()},onKeyDown:a=>{var o;(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),(o=r.current)==null||o.click())},onDragOver:a=>{a.preventDefault(),l(!0)},onDragLeave:()=>l(!1),onDrop:a=>{var o;a.preventDefault(),l(!1),n((o=a.dataTransfer)!=null&&o.files?Array.from(a.dataTransfer.files):[])},children:[e.jsxs("div",{className:"dz-inner",children:[e.jsx("div",{className:"dz-icon","aria-hidden":"true",children:E}),e.jsxs("div",{children:["Drag & drop file, or ",e.jsx("span",{className:"link",children:"browse"})]})]}),e.jsx("input",{ref:r,type:"file",hidden:!0,onChange:a=>n(a.target.files?Array.from(a.target.files):[])})]})}const C=s=>typeof s!="number"||Number.isNaN(s)?0:Math.min(100,Math.max(0,s));function y({items:s=[],emptyMessage:r="No uploads yet."}){return s.length?e.jsx("div",{className:"results react-items",children:s.map(t=>e.jsxs("div",{className:"item",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"name",children:t.name}),e.jsx("div",{className:`meta ${t.isSuccess?"ok":t.isError?"err":""}`,"data-status":!0,children:t.status})]}),e.jsx("div",{className:"bar",children:e.jsx("div",{className:"fill","data-fill":!0,style:{width:`${C(t.progress)}%`}})}),t.detail?e.jsx("div",{className:`meta ${t.isError?"err":""}`,"data-detail":!0,children:t.detail}):null,Array.isArray(t.extra)?t.extra.map((l,n)=>e.jsx("div",{className:"meta",children:l},n)):null]},t.id))}):e.jsx("p",{className:"meta",children:r})}const I=3,$=()=>{const s=typeof globalThis<"u"?globalThis.crypto:null;return s&&typeof s.randomUUID=="function"?s.randomUUID():`upload-${Date.now()}-${Math.random().toString(16).slice(2)}`},R=s=>{const r=(s==null?void 0:s.ingestion)||{},t=r.sections_processed??"-",l=r.chunks_processed??"-";return`sections: ${t}, chunks: ${l}`},T=(s,r)=>{var t;return s?s.error||s.detail||((t=s==null?void 0:s.ingestion)==null?void 0:t.error)||(r?`Upload failed (HTTP ${r})`:"Upload failed"):r?`Upload failed (HTTP ${r})`:"Upload failed (network error)"},B=(s,{onProgress:r})=>new Promise(t=>{const l=new FormData;l.append("file",s);const n=new XMLHttpRequest;n.open("POST","/files/upload"),n.upload.addEventListener("progress",a=>{if(!a.lengthComputable)return;const o=Math.round(a.loaded/a.total*100);r==null||r(o)}),n.onreadystatechange=()=>{if(n.readyState!==4)return;let a=null;try{a=JSON.parse(n.responseText||"{}")}catch(h){console.error("Unable to parse upload response",h)}const o=n.status>=200&&n.status<300;t({ok:o,payload:a,status:n.status||0})},n.onerror=()=>t({ok:!1,payload:null,status:n.status||0}),n.send(l)}),M=async(s,r)=>{if(!s.length)return;const t=new Set;for(const l of s){const n=Promise.resolve().then(l);t.add(n);const a=()=>t.delete(n);n.then(a).catch(a),t.size>=r&&await Promise.race(t)}await Promise.allSettled(Array.from(t))},A=(s,r)=>{s(t=>[r,...t])},m=(s,r,t)=>{s(l=>l.map(n=>n.id===r?{...n,...t}:n))};function L(){const[s,r]=i.useState(()=>k()),[t,l]=i.useState([]),[n,a]=i.useState([]),[o,h]=i.useState([]),[j,N]=i.useState(!1),g=i.useRef(null);i.useEffect(()=>{r(k())},[]);const x=i.useCallback((c,f)=>{const u=c==="single"?l:a,p=$(),v={id:p,name:f.name,progress:0,status:"Queued",detail:"",isSuccess:!1,isError:!1};return A(u,v),m(u,p,{status:"Uploading",detail:"Initializing upload"}),B(f,{onProgress:d=>m(u,p,{progress:d,status:"Uploading"})}).then(d=>{d.ok?m(u,p,{status:"Ingested",detail:R(d.payload),progress:100,isSuccess:!0,isError:!1}):m(u,p,{status:"Failed",detail:T(d.payload,d.status),isError:!0})})},[]),b=i.useCallback(c=>{c&&x("single",c)},[x]),U=async()=>{if(!o.length)return;N(!0);const c=o.map(f=>()=>x("bulk",f));await M(c,I),N(!1),h([]),g.current&&(g.current.value="")};return e.jsxs("div",{className:"react-app",children:[e.jsxs("header",{className:"container header react-header",children:[e.jsx("div",{className:"brand",children:"CFC Technologies"}),e.jsx("div",{className:"greet",children:s?`Hi, ${s}!`:"Welcome back"})]}),e.jsxs("main",{className:"container dashboard-main",children:[e.jsx("section",{className:"panel active",children:e.jsxs("div",{className:"panel-body",children:[e.jsx("h2",{children:"Upload & Ingest"}),e.jsx("p",{children:"Drop a file below. Uploading automatically starts ingestion."}),e.jsx(w,{onFileSelected:b}),e.jsx(y,{items:t,emptyMessage:"No uploads yet."})]})}),e.jsx("section",{className:"panel active",children:e.jsxs("div",{className:"panel-body",children:[e.jsx("h2",{children:"Bulk Uploads"}),e.jsx("p",{children:"Select multiple files. We keep three uploads running at a time."}),e.jsxs("div",{className:"controls",children:[e.jsx("input",{ref:g,type:"file",multiple:!0,onChange:c=>h(c.target.files?Array.from(c.target.files):[])}),e.jsx("button",{type:"button",className:"btn",disabled:!o.length||j,onClick:U,children:j?"Uploading...":"Start Upload"})]}),e.jsx("div",{className:"meta",children:o.length?`${o.length} file${o.length>1?"s":""} selected`:"No files selected yet"}),e.jsx(y,{items:n,emptyMessage:"No bulk uploads yet."})]})})]}),e.jsx("footer",{className:"container footer",children:e.jsx("a",{className:"btn",href:"/ui/login.html","aria-label":"Back to Login",children:"Back to Login"})})]})}S.createRoot(document.getElementById("root")).render(e.jsx(D.StrictMode,{children:e.jsx(L,{})}));
