import{j as e,r as l,g as k,c as $,R as B}from"./styles-D9vFcHhE.js";function C({attachments:t=[],onImageClick:s}){return t.length?e.jsx("div",{className:"img-grid",children:t.map(n=>e.jsx("button",{type:"button",className:"img-grid-btn",onClick:()=>s==null?void 0:s(n),children:e.jsx("img",{src:n.previewUrl,alt:n.name||"attachment"})},n.id))}):null}function O({message:t,onImageClick:s}){const n=t.role==="user"?"user":"bot",r=["msg",n];t.isTyping&&r.push("typing"),t.isError&&r.push("err");const g=t.isTyping?e.jsxs("span",{className:"typing-text",children:["Assistant is thinking",e.jsx("span",{className:"dots"})]}):t.text;return e.jsxs("div",{className:r.join(" "),children:[e.jsx("p",{className:"msg-text",children:g}),n==="user"&&Array.isArray(t.attachments)&&t.attachments.length?e.jsx(C,{attachments:t.attachments,onImageClick:s}):null,t.timestamp?e.jsx("div",{className:"meta",children:t.timestamp}):null]})}function P({messages:t=[],onImageClick:s}){const n=l.useRef(null);return l.useEffect(()=>{const r=n.current;r&&(r.scrollTop=r.scrollHeight)},[t]),e.jsx("div",{className:"thread",ref:n,"aria-live":"polite","aria-relevant":"additions",children:t.map(r=>e.jsx(O,{message:r,onImageClick:s},r.id))})}function q({attachments:t=[],onRemove:s}){return t.length?e.jsx("div",{className:"attachment-strip",children:t.map(n=>e.jsxs("div",{className:"attachment-chip",children:[e.jsx("img",{src:n.previewUrl,alt:n.name||"attachment"}),e.jsxs("div",{className:"attachment-meta",children:[e.jsx("div",{className:"attachment-name",children:n.name||"Attachment"}),e.jsx("button",{type:"button",onClick:()=>s==null?void 0:s(n.id),"aria-label":`Remove ${n.name||"attachment"}`,children:"×"})]})]},n.id))}):null}function F({image:t,onClose:s}){return l.useEffect(()=>{if(!t)return;const n=r=>{r.key==="Escape"&&(s==null||s())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[t,s]),e.jsx("div",{className:`img-modal ${t?"active":""}`,onClick:()=>s==null?void 0:s(),role:"dialog","aria-label":"Image preview","aria-modal":"true",children:t?e.jsx("img",{src:t.previewUrl,alt:t.name||"attachment preview",onClick:n=>n.stopPropagation()}):null})}const b=()=>{const t=typeof globalThis<"u"?globalThis.crypto:null;return t!=null&&t.randomUUID?t.randomUUID():`msg-${Date.now()}-${Math.random().toString(16).slice(2)}`},y=()=>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});function G(){const[t,s]=l.useState(()=>k()),[n,r]=l.useState(""),[g,f]=l.useState([]),[m,u]=l.useState([]),[x,w]=l.useState(!1),[S,N]=l.useState(null),p=l.useRef(null);l.useEffect(()=>{s(k())},[]);const A=l.useCallback(a=>{if(!(a!=null&&a.length))return;const o=a.map(c=>({id:b(),name:c.name||"attachment",previewUrl:URL.createObjectURL(c),file:c}));u(c=>[...c,...o])},[]),L=a=>{const o=Array.from(a.target.files||[]);A(o),a.target.value=""},U=a=>{u(o=>{const c=o.find(h=>h.id===a);if(c!=null&&c.previewUrl)try{URL.revokeObjectURL(c.previewUrl)}catch{}return o.filter(h=>h.id!==a)})},E=()=>{u([])},T=async()=>{const a=n.trim(),o=m;if(!a&&!o.length)return;const c={id:b(),role:"user",text:a,attachments:o.map(i=>({id:i.id,name:i.name,previewUrl:i.previewUrl})),timestamp:y()},h=b();f(i=>[...i,c,{id:h,role:"assistant",text:"Assistant is thinking…",isTyping:!0}]),r(""),w(!0),u([]);try{let i;if(o.length){const d=new FormData;d.append("question",a),d.append("top_k","4"),o.forEach(D=>d.append("images",D.file)),i=await(await fetch("/ask-with-media",{method:"POST",body:d})).json()}else i=await(await fetch("/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:a,top_k:4})})).json();const j=i!=null&&i.success?i.answer||"No answer provided yet.":(i==null?void 0:i.detail)||"Request failed.";f(d=>d.map(v=>v.id===h?{id:h,role:"assistant",text:j,isTyping:!1,isError:!(i!=null&&i.success),timestamp:y()}:v))}catch(i){f(j=>j.map(d=>d.id===h?{id:h,role:"assistant",text:String(i),isTyping:!1,isError:!0,timestamp:y()}:d))}finally{w(!1),E(),p.current&&(p.current.value="")}},I=a=>{a.preventDefault(),T()},M=a=>N(a),R=()=>N(null);return e.jsxs("div",{className:"react-app",children:[e.jsxs("header",{className:"container header react-header",children:[e.jsx("div",{className:"brand",children:"CFC Software Support"}),e.jsx("div",{className:"greet",children:t?`Hi, ${t}!`:"Welcome back"})]}),e.jsx("main",{className:"container chat-container",children:e.jsx("section",{className:"panel active chat-panel",children:e.jsxs("div",{className:"panel-body chat-panel-body",children:[e.jsx("h2",{children:"Chat with AI Assistant"}),e.jsx(P,{messages:g,onImageClick:M}),e.jsx(q,{attachments:m,onRemove:U}),e.jsxs("form",{className:"chat-input react-chat-input",onSubmit:I,children:[e.jsx("input",{type:"text",placeholder:"Ask anything about CFC software…",value:n,onChange:a=>r(a.target.value),disabled:x}),e.jsx("input",{ref:p,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:L}),e.jsx("button",{type:"button",className:"btn icon",onClick:()=>{var a;return(a=p.current)==null?void 0:a.click()},"aria-label":"Attach images",disabled:x,children:e.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M21 8.5l-9.19 9.19a5 5 0 01-7.07 0h0a5 5 0 010-7.07L13.5 1.75a3.5 3.5 0 114.95 4.95L8.3 16.86a2 2 0 01-2.83 0h0a2 2 0 010-2.83L15.2 4.31",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"btn icon",type:"submit",disabled:x,"aria-label":"Send message",children:e.jsx("svg",{viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",children:e.jsx("path",{d:"M3 11.5l18-8-8 18-2.5-6.5L3 11.5z",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{className:"meta",children:m.length?`${m.length} image${m.length>1?"s":""} ready to send`:"Images are optional. Upload screenshots for richer answers."})]})})}),e.jsx("footer",{className:"container footer",children:e.jsx("a",{className:"btn",href:"/ui/login.html","aria-label":"Back to Login",children:"Back to Login"})}),e.jsx(F,{image:S,onClose:R})]})}$.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(G,{})}));
